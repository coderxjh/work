<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jcxx.saas.modules.sys.dao.DepartmentDao">
    <select id="selectUserListByDeptId" resultType="com.jcxx.saas.modules.sys.entity.DepartmentEntity">
        SELECT dept_id,
               dept_name
        FROM (SELECT t1.dept_id,
                     t1.dept_name,
                     IF
                         (find_in_set(parent_dept_id, @pids) > 0, @pids := concat(@pids, ',', dept_id), 0) AS ischild
              FROM (SELECT dept_id, parent_dept_id, dept_name FROM department d ORDER BY parent_dept_id, dept_id) t1,
                   (SELECT @pids := #{deptId}) t2) t3
        WHERE ischild != 0
           OR dept_id = #{deptId}
    </select>
</mapper>